<!doctype html>
<html lang="es">
  <head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <meta name="robots" content="noindex" />
   <link href="config.yml" type="text/yaml" rel="cms-config-url" />
   <title>Administrador de contenidos del blog</title>
  <!--  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> -->
  </head>
 <body>
   <script src="https://unpkg.com/decap-cms@^3.1.2/dist/decap-cms.js"></script>
  <!--  <script>
    if (window.netlifyIdentity) {
      // Evento que se ejecuta cuando Netlify Identity se inicializa
      window.netlifyIdentity.on("init", (user) => {
        // **Verificación en la inicialización:**
        // Si no hay un usuario autenticado al cargar la página
        if (!user) {
          // Escucha el evento de inicio de sesión
          window.netlifyIdentity.on("login", () => {
            // Redirige al usuario al panel de administración si inicia sesión
            document.location.href = "/admin/";
          });
        } else {
          // Si ya hay un usuario autenticado, verifica si está autorizado
          verifyUser(user);
        }
      });
  
      // **Verificación al iniciar sesión:**
      // Este evento se ejecuta cada vez que un usuario inicia sesión
      window.netlifyIdentity.on("login", (user) => {
        // Llama a la función de verificación para determinar si el usuario tiene acceso
        verifyUser(user);
      });
  
      // **Restricción para usuarios no autenticados:**
      // Evento que se ejecuta cuando un usuario cierra sesión
      window.netlifyIdentity.on("logout", () => {
        // Redirige al usuario a la página de inicio después de cerrar sesión
        document.location.href = "/";
      });
  
      // Función para verificar el estado del usuario autenticado
      function verifyUser(user) {
        // Verifica si el correo electrónico del usuario está confirmado
        if (user.email_verified) {
          // Si está confirmado, permite el acceso al panel de administración
          document.location.href = "/admin/";
        } else {
          // Si no está confirmado, muestra una alerta y cierra la sesión automáticamente
          alert("Tu acceso no está confirmado. Por favor, verifica tu invitación.");
          window.netlifyIdentity.logout();
        }
      }
    }
  </script> -->
  
 </body>
</html>